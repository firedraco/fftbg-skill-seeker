<!doctype html>

<html lang="en">
<head>
	<meta charset="utf-8">

	<title>FFT Skill Seeker</title>
	<meta name="author" content="firedraco">
	<style>
		body {
			color: #DCDCDC;
			background-color: #201F1D;
		}
	</style>
</head>
<body>
	<table>
		<thead>
			<tr>
				<th>Skill Name</th>
				<th>Last Dropped</th>
			</tr>
		</thead>
		<tbody id="tableBody">
		</tbody>
	</table>
	<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
	<script>
		$(async function() {
			function fillInTable( tournamentsJson ) {
				var skills = tournamentsJson.map( (t, index) => ({ "Name": t.SkillDrop, "LastDropped": t.LastMod, Index: index }));
				var filteredSkills = skills.sort( (s1, s2) => s1.Index > s2.Index ).filter((skill, index, array) => array.findIndex(ele => ele.Name == skill.Name) === index);

                const tableBody = $("#tableBody");
                tableBody.empty();
                for( var i = 0; i <= filteredSkills.length; ++i ) {
                    tableBody
                        .append( $( "<tr>" )
                            .append( $("<td>")
                                .text( filteredSkills[i].Name )
                            )
                            .append( $("<td>")
                                .text( filteredSkills[i].Name )
                            )
                        );
				}
			}

			try {
				const response = await fetch("https://fftbg.com/api/tournaments?limit=2");
				const data = await response.json();
			    fillInTable( data );
			} catch ( e ) {
                const tableBody = $("#tableBody");
                tableBody
                    .empty()
                    .append( $( "<tr>" )
                        .append( $("<td>")
                            .attr( "colspan", 2 )
                            .text( "There was an error retreiving the data." )
                        )
                    );
            }
		});
	</script>
</body>
</html>
