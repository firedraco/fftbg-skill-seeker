<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>FFT Skill Seeker</title>
    <meta name="author" content="firedraco">
    <style>
        body {
            color: #DCDCDC;
            background-color: #201F1D;
        }
    </style>
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/4.4.3/css/tabulator.min.css" />
</head>

<body>
    <table id="table">
        <thead>
            <tr>
                <th>Skill Name</th>
                <th>Last Dropped</th>
                <th>Tournaments Ago</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/4.4.3/js/tabulator.min.js"></script>
    <script>
        $(async function () {
            function fillInTable(tournamentsJson) {
                var skills = tournamentsJson.map((t, index) => ({ "Name": t.SkillDrop, "LastDropped": t.LastMod, Index: index }));
                var filteredSkills = skills.sort((s1, s2) => s1.Index > s2.Index).filter((skill, index, array) => array.findIndex(ele => ele.Name == skill.Name) === index);

                const tableBody = $("#table > tbody");
                tableBody.empty();
                for (var i = 0; i < filteredSkills.length; ++i) {
                    tableBody
                        .append($("<tr>")
                            .append($("<td>")
                                .text(filteredSkills[i].Name)
                            )
                            .append($("<td>")
                                .text(filteredSkills[i].LastDropped)
                            )
                            .append($("<td>")
                                .text(filteredSkills[i].Index)
                            )
                        );
                }

                var table = new Tabulator("#table", {});
            }

            try {
                const response = await fetch("https://fftbg.com/api/tournaments");
                const data = await response.json();
                fillInTable(data);
            } catch (e) {
                $("#table")
                    .empty()
                    .text( "There was an error retreiving the data." );
            }
        });
    </script>
</body>

</html>
