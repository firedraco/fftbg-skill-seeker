<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>FFT Skill Seeker</title>
    <meta name="author" content="firedraco">
    <style>
        body {
            color: #DCDCDC;
            background-color: #201F1D;
        }

        #siteDiv {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #errorMessage {
            padding-bottom: 10px;
        }

        #table {
            width: 40%;
        }
    </style>
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/tabulator/4.4.3/css/tabulator.min.css" />
</head>

<body>
    <div id="siteDiv">
        <div id="errorMessage">
        </div>
        <div id="table">
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tabulator/4.4.3/js/tabulator.min.js"></script>
    <script>
        $(async function () {
            function filterData(tournamentsJson) {
                var skills = tournamentsJson.map((t, index) => ({ "Name": t.SkillDrop, "LastDropped": t.LastMod, Index: index }));
                return skills.sort((s1, s2) => s1.Index > s2.Index).filter((skill, index, array) => array.findIndex(ele => ele.Name == skill.Name) === index);
            }

            const table = new Tabulator("#table", {
                columns: [
                    { title: "Skill Name", field: "Name" },
                    { title: "Last Dropped", field: "LastDropped" },
                    { title: "Tournaments Ago", field: "Index" }
                ]
            });

            try {
                $("#errorMessage")
                    .empty();

                const response = await fetch("https://fftbg.com/api/tournaments");
                const data = await response.json();

                table.setData(filterData(data));
            } catch (e) {
                $("#errorMessage")
                    .empty()
                    .text("There was an error retreiving the data.");
            }
        });
    </script>
</body>

</html>
